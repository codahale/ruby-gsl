<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>
Least-Squares Fitting</title>

  
<style type="text/css">
<!--
body {background-color: white; color: black;}
a {background-color: white; color: blue; text-decoration: underline;}
a:hover {text-decoration: none;}
td.head,td.headcenter {background-color: #99ccff; color: black;}
td.headcenter {width: 100%; text-align: center;}
img {border-style: none;}
-->
  </style>
                
<style type="text/css">
<!--
.code {font-family: Courier; font-size: 85%;}
.keyword {color: #0000ff;}
.comment {color: #008000;}
.quote {color: #ff0000;}
.function {color: #0000ff;}
-->
</style></head>
<body>
<hr>
<table width="100%" cellpadding="0" cellspacing="2" border="0"><tbody>
<tr>
<td width="20" class="head"><a href=".html"><img border="0" alt="next" src="next.png"></a></td>
<td width="20" class="head"><a href="index.html"><img border="0" alt="up" src="up.png"></a></td>
<td width="20" class="head"><a href=".html"><img border="0" alt="previous" src="prev.png"></a></td>
<td width="100%" class="headcenter">Least-Squares Fitting</td> 
</tr></tbody></table><hr><h1>
Least-Squares Fitting</h1>
<hr>

This chapter describes routines for performing least squares fits to
experimental data using linear combinations of functions. The data may be
weighted or unweighted. For weighted data the functions compute the best
fit parameters and their associated covariance matrix. For unweighted
data the covariance matrix is estimated from the scatter of the points,
giving a variance-covariance matrix. The functions are divided into
separate versions for simple one- or two-parameter regression and
multiple-parameter fits. <br>
The functions are declared in the header file `gsl_fit.h' 

<h3>Module Fit</h3>

<h3>Linear regression</h3>

The functions described in this section can be used to perform
least-squares fits to a straight line model, Y = c_0 + c_1 X. For
weighted data the best-fit is found by minimizing the weighted sum of
squared residuals, \chi^2,
<br>
\chi^2 = \sum_i w_i (y_i - (c_0 + c_1 x_i))^2
<br>
for the parameters c_0, c_1. For unweighted data the sum is computed with
w_i = 1.  

<p>
<a name="linear"></a>
<tt>Fit::linear</tt><br>
<tt>Fit::linear(x, y) -> [c0, c1, cov00, cov01, cov11, sum2q]</tt><br>

This function computes the best-fit linear regression coefficients
(c0,c1) of the model Y = c_0 + c_1 X for the datasets (x, y), two vectors
of length n (with strides 1). The variance-covariance
matrix for the parameters (c0, c1) is estimated from the scatter of the
points around the best-fit line and returned via the parameters (cov00,
cov01, cov11). The sum of squares of the residuals from the best-fit
line is returned in sumsq.
<p>
<a name="wlinear"></a>
<tt>Fit::wlinear</tt><br>
<tt>Fit::wlinear(x, w, y) -> [c0, c1, cov00, cov01, cov11, sum2q]</tt><br>
This function computes the
best-fit linear regression coefficients (c0,c1) of the model Y = c_0 +
c_1 X for the weighted datasets (x, y), two vectors of length n (with
strides 1). The vector w
specifies the weight of each datapoint. The weight is the reciprocal of
the variance for each datapoint in y.
<br>
The covariance matrix for the parameters (c0, c1) is estimated from
weighted data and returned via the parameters (cov00, cov01, cov11). The
weighted sum of squares of the residuals from the best-fit line, \chi^2,
is returned in chisq.
<p>
<a name="linear_est"></a>
<tt>Fit::linear_est</tt><br>
<tt>Fit::linear_est(x, c0, c1, cov00, cob01, cov11, sumsq) -> [y, yerr]</tt><br>
This function uses
the best-fit linear regression coefficients c0,c1 and their estimated
covariance cov00,cov01,cov11 to compute the fitted function y and its
standard deviation y_err for the model Y = c_0 + c_1 X at the point x.

<TABLE BORDER="0" BGCOLOR="#E0E0E0" WIDTH="100%" ><TR><TD><PRE>&#13;#!/usr/local/bin/ruby

# $Id: fit.html,v 1.1 2003/09/20 12:26:41 pernici Exp $

require "GSL"
include GSL::Fit

# Test Least-Squares Fitting
# Usage: 
# $ ./fit.rb &gt; tmp
# $ for n in data fit hi lo;  do grep "^$n" tmp | cut -d ':' -f 2 &gt; $n; done
# $ graph -TX -X x -Y y -y 0 20 -m 0 -S 2 -Ie data -S 0 -I a -m 1 fit -m 2 hi lo

STDERR.puts "Running tests for Least-Squares Fitting..."

x = [1970, 1980, 1990, 2000]
y = [  12,   11,   14,   13]
w = [ 0.1,  0.2,  0.3,  0.4]

res = wlinear(x, w, y)
c0 = res[0]
c1 = res[1]
cov00 = res[2]
cov01 = res[3]
cov11 = res[4]
chisq = res[5]

puts "Best fit: Y = %g + %g X" % [c0, c1]
puts "Covariance matrix:"
puts "  [ %g, %g\n    %g, %g ]" % [cov00, cov01, cov01, cov11]
puts "Chi-squared: #{chisq}"

x.each_index do |i|
  puts "data: #{x[i]} #{y[i]} #{1/Math::sqrt(w[i])}"
end

(-30).upto(130) do |i|
  xf = x[0] + (i/100.0) * (x[3]-x[0])
  yf, yf_err = linear_est(xf, c0, c1, cov00, cov01, cov11)
  puts "fit: #{xf} #{yf}"
  puts "hi: #{xf} #{yf+yf_err}"
  puts "lo: #{xf} #{yf-yf_err}"
end

STDERR.puts "\ndone."
</PRE></TD></TR></TABLE></DIV></TD></TR></TABLE>
<h3>Linear fitting without a constant term</h3>

The functions described in this section can be used to perform
least-squares fits to a straight line model without a constant term,
Y = c_1 X. For weighted data the best-fit is found by minimizing the
weighted sum of squared residuals, \chi^2,
<br>
\chi^2 = \sum_i w_i (y_i - c_1 x_i)^2
<br>
for the parameter c_1. For unweighted data the sum is computed with w_i
= 1.
<p>
<a name="mul"></a>
<tt>Fit::mul</tt><br>
<tt>Fit::mul(x, y) -> [c1, cov11, sumsq]</tt><br>

This function computes the best-fit linear regression
coefficient c1 of the model Y = c_1 X for the datasets (x, y), two
vectors of length n (with strides 1). The variance of
the parameter c1 is estimated from the scatter of the points around the
best-fit line and returned via the parameter cov11. The sum of squares
of the residuals from the best-fit line is returned in sumsq.
<p>
<a name="wmul"></a>
<tt>Fit::wmul</tt><br>
<tt>Fit::wmul(x, w, y) -> [c1, cov11, sumsq]</tt><br>
This function computes the best-fit linear regression coefficient c1 of
the model Y = c_1 X for the weighted datasets (x, y), two vectors of
length n (with strides 1). The vector w specifies the weight of each 
datapoint. The weight
is the reciprocal of the variance for each datapoint in y.
<br>
The variance of the parameter c1 is estimated from the weighted data
and returned via the parameters cov11. The weighted sum of squares of
the residuals from the best-fit line, \chi^2, is returned in chisq.
<p>
<a name="mul_est"></a>
<tt>Fit::mul_est</tt><br>
<tt>Fit::mul_est(x, c1, c11) -> [y, yerr]</tt><br>
This function uses the best-fit linear regression coefficient c1 and its 
estimated covariance cov11 to compute the fitted function y and its 
standard deviation y_err for the model Y = c_1 X at the point x.

<h3>Multi-parameter fitting</h3>
MISSING<br>

<h3>References and Further Reading</h3>
A summary of formulas and techniques for least squares fitting can be found 
in the "Statistics" chapter of the Annual Review of Particle Physics 
prepared by the Particle Data Group.
<ul><li>
 Review of Particle Properties R.M. Barnett et al., 
 Physical Review D54, 1 (1996) 
 <a href="http://pdg.lbl.gov/">http://pdg.lbl.gov/</a>
</ul>
    The Review of Particle Physics is available online at the website given 
    above.
<p>
    The tests used to prepare these routines are based on the 
    NIST Statistical Reference Datasets. 
    The datasets and their documentation are available from NIST at the 
    following website,
<br>
<a href="http://www.nist.gov/itl/div898/strd/index.html.">http://www.nist.gov/itl/div898/strd/index.html</a>
    

<hr>
<table width="100%" cellpadding="0" cellspacing="2" border="0"><tbody>
<tr>
<td width="20" class="head"><a href=""><img border="0" alt="next" src="next.png"></a></td>
<td width="20" class="head"><a href="index.html"><img border="0" alt="up" src="up.png"></a></td>
<td width="20" class="head"><a href=""><img border="0" alt="previous" src="prev.png"></a></td>
<td width="100%" class="headcenter">Least-Squares Fitting</td> 
</tr></tbody></table><hr></body>
</html>
